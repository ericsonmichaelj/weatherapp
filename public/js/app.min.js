$(function(){"use strict";var e="c200d66e223bd37f3faa3aca4cb7f9ab",t="http://api.openweathermap.org/data/2.5/",a=t+"weather?APPID="+e+"&units=imperial",r=t+"forecast/?APPID="+e+"&units=imperial",n=36e5,i={0:"Sunday",1:"Monday",2:"Tuesday",3:"Wednesday",4:"Thursday",5:"Friday",6:"Saturday"},s=function(e){this.date=new Date(1e3*e),this.totalCount=0,this.totalTemperature=0,this.mainIcons={},this.mainWeathers={},this.totalPressure=0,this.totalHumidity=0,this.totalWindSpeed=0,this.totalClouds=0};s.prototype.update=function(e){this.totalCount++,this.totalTemperature+=e.main.temp,this.totalPressure+=e.main.pressure,this.totalHumidity+=e.main.humidity,this.totalWindSpeed+=e.wind.speed,this.totalClouds+=e.clouds.all,this.mainIcons[e.weather[0].icon]?this.mainIcons[e.weather[0].icon]++:this.mainIcons[e.weather[0].icon]=1,this.mainWeathers[e.weather[0].main]?this.mainWeathers[e.weather[0].main]++:this.mainWeathers[e.weather[0].main]=1},s.prototype.getAverageResults=function(){var e={weather:[{main:null,icon:null}],dt:this.date.getTime()/1e3,wind:{speed:null},clouds:{all:null},humidity:null,pressure:null,main:{temp:null,pressure:null,humidity:null}};e.wind.speed=+(this.totalWindSpeed/this.totalCount).toFixed(2),e.main.temp=+(this.totalTemperature/this.totalCount).toFixed(2),e.main.pressure=+(this.totalPressure/this.totalCount).toFixed(0),e.main.humidity=+(this.totalHumidity/this.totalCount).toFixed(0),e.wind.speed=+(this.totalWindSpeed/this.totalCount).toFixed(2),e.clouds.all=+(this.totalClouds/this.totalCount).toFixed(0);var t=0,a=0;for(var r in this.mainIcons)t<this.mainIcons[r]&&(e.weather[0].icon=r,t=this.mainIcons[r]);for(var n in this.mainWeathers)a<this.mainWeathers[n]&&(e.weather[0].main=n,a=this.mainWeathers[n]);return e};var h=function(e,t){return e.getDay()===t.getDay()?"Today":i[e.getDay()]},o={init:function(){this.renderLoader(),this.currentWeather=null,this.weatherForecast=null,this.currentWeatherInterval=null,this.weatherForecastInterval=null,this.lastCurrentWeatherUpdate=null,this.lastWeatherForecastUpdate=null,this.longitude=null,this.latitude=null;var e=this;navigator.geolocation.getCurrentPosition(function(t){e.addEventListeners(),e.latitude=t.coords.latitude,e.longitude=t.coords.longitude,e.changePageToCurrentWeather()},e.renderNavigatorMessage.bind(e))},addEventListeners:function(){var e=this;document.getElementById("current-weather").addEventListener("click",e.changePageToCurrentWeather.bind(e)),document.getElementById("five-day-forecast").addEventListener("click",e.changePageToForecastWeather.bind(e))},fetch:function(e,t){this.renderLoader(),$.get({url:e,dataType:"json",success:t.bind(this),error:this.renderErrorMessage.bind(this)})},fetchCurrentWeather:function(){this.fetch(a+"&lat="+this.latitude+"&lon="+this.longitude,this.updateCurrentWeather)},fetchForecastWeather:function(){this.fetch(r+"&lat="+this.latitude+"&lon="+this.longitude,this.updateForecastWeather)},renderCurrentWeather:function(){this.onCurrentWeatherPage()||$("#five-day-forecast").removeClass("hide"),this.getAppId().innerHTML=this.createWeatherPanel(this.currentWeather,this.lastCurrentWeatherUpdate)},renderForecastWeather:function(){this.onFiveDayForecastPage||$("#current-weather").removeClass("hide");for(var e=this.weatherForecast.list,t=[],a=new s(e[0].dt),r=0;r<e.length;r++){var n=e[r];h(a.date,this.lastWeatherForecastUpdate)===h(new Date(1e3*n.dt),this.lastWeatherForecastUpdate)?a.update(n):(t.push(this.createWeatherPanel(a.getAverageResults(),this.lastWeatherForecastUpdate)),a=new s(n.dt))}this.getAppId().innerHTML=t},renderLoader:function(){this.getAppId().innerHTML='<h3 class="loader-message">Loading Please wait...</h3><div class="loader"></div>'},renderErrorMessage:function(){this.getAppId().innerHTML="<span class='error'>We're sorry but there was an error retrieving this information. <br>Please contact ericson.michael.j@gmail.com for support or try again later.</span>"},renderNavigatorMessage:function(){this.getAppId().innerHTML="<div class='navigator-message-container'><p class='navigator-message'>Something went wrong in trying to detect your location. Please check your web browser settings and see if we have permission to know your location or contact customer support at ericson.michael.j@gmail.com</p></div>"},updateCurrentWeather:function(e){this.lastCurrentWeatherUpdate=new Date,this.currentWeather=e,this.renderCurrentWeather()},updateForecastWeather:function(e){this.lastWeatherForecastUpdate=new Date,this.weatherForecast=e,this.renderForecastWeather()},changePageToCurrentWeather:function(){$("#current-weather").addClass("hide"),this.clearForecastWeatherInterval(),null===this.currentWeather||new Date-this.lastCurrentWeatherUpdate>n?this.fetchCurrentWeather():this.renderCurrentWeather(),null===this.currentWeatherInterval&&this.fetchCurrentWeatherPeriodiocally()},changePageToForecastWeather:function(){$("#five-day-forecast").addClass("hide"),this.clearCurrentWeatherInterval(),null===this.weatherForecast||new Date-this.lastWeatherForcastUpdate>n?this.fetchForecastWeather():this.renderForecastWeather(),null===this.forecastWeatherInterval&&this.fetchForecastWeatherPeriodiocally()},fetchCurrentWeatherPeriodiocally:function(){this.currentWeatherInterval=setInterval(this.fetchCurrentWeather.bind(this),n)},fetchForecastWeatherPeriodiocally:function(){this.forecastWeatherInterval=setInterval(this.fetchForecastWeather.bind(this),n)},clearForecastWeatherInterval:function(){clearInterval(this.forecastWeatherInterval),this.forecastWeatherInterval=null},clearCurrentWeatherInterval:function(){clearInterval(this.currentWeatherInterval),this.currentWeatherInterval=null},onCurrentWeatherPage:function(){return!$("#five-day-forecast").hasClass("hide")},onFiveDayForcastPage:function(){return!$("#current-weather").hasClass("hide")},getAppId:function(){return document.getElementById("app")},createWeatherPanel:function(e,t){return"<div class='weather-panel'><div class='date'>"+h(new Date(1e3*e.dt),t)+"</div><h1 class='weather-main'>"+e.weather[0].main+" - "+e.main.temp+"&#8457</h1><img class='weather-image'src='http://openweathermap.org/img/w/"+e.weather[0].icon+".png'><div class='weather-secondary'><div class='col-6'><p> <span class='title'> Humidity: </span>"+e.main.humidity+"%</p><p> <span class='title'> Pressure: </span>"+e.main.pressure+" hPa</p></div><div class='col-6'><p> <span class='title'> Winds: </span>"+e.wind.speed+" mph</p><p> <span class='title'>Clouds: </span>"+e.clouds.all+"%</p></div></div></div>"}};o.init()});